(this.webpackJsonphashlife=this.webpackJsonphashlife||[]).push([[0],{13:function(e,t,i){e.exports=i(18)},18:function(e,t,i){"use strict";i.r(t);var n=i(2),r=i.n(n),s=i(9),a=i.n(s),o=i(12),h=i(0),u=i(1),c=i(4),l=i(5),f=i(10),v=function(){function e(t,i,n){Object(h.a)(this,e),this.gl=t,this.create_shader_program(i,n),this.uniforms=[],this.locations=[]}return Object(u.a)(e,[{key:"create_shader_program",value:function(e,t){var i=function(e,t,i){var n=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw console.error(e.getShaderInfoLog(n)),console.error(d(t)),new Error("Unable to compile vertex shader");var r=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw console.error(e.getShaderInfoLog(r)),new Error("Unable to compile fragment shader");var s=e.createProgram();if(e.attachShader(s,n),e.attachShader(s,r),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw console.error(e.getProgramInfoLog(s)),console.error(d(i)),new Error("Unable to construct shader program");return[n,r,s]}(this.gl,e,t),n=Object(f.a)(i,3);this.vertex_shader=n[0],this.fragment_shader=n[1],this.program=n[2]}},{key:"add_uniform",value:function(e,t){var i=this.gl.getUniformLocation(this.program,e);this.uniforms.push(t),this.locations.push(i)}},{key:"bind",value:function(){this.gl.useProgram(this.program);for(var e=0;e<this.uniforms.length;e++){var t=this.uniforms[e],i=this.locations[e];null!==i&&t.apply(i)}}}]),e}();function d(e){return e.split("\n").map((function(e,t){return"".concat(t+1,"\t| ").concat(e)})).join("\n")}var _=i(7),p=function(){function e(t,i,n){Object(h.a)(this,e),this.gl=t,this.data=i,this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,i,n)}return Object(u.a)(e,[{key:"bind",value:function(){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,this.vbo)}}]),e}(),b=function(){function e(t){Object(h.a)(this,e),this.gl=t,this.vao=t.createVertexArray(),this.integer_types=new Set([t.INT,t.UNSIGNED_INT])}return Object(u.a)(e,[{key:"add_vertex_buffer",value:function(e,t){var i=this.gl;this.bind(),e.bind();var n,r=0,s=Object(_.a)(t.attributes);try{for(s.s();!(n=s.n()).done;){var a=n.value;i.enableVertexAttribArray(a.index),this.integer_types.has(a.type)?i.vertexAttribIPointer(a.index,a.count,a.type,a.is_normalised,t.stride,r):i.vertexAttribPointer(a.index,a.count,a.type,a.is_normalised,t.stride,r),r+=a.count*a.size}}catch(o){s.e(o)}finally{s.f()}}},{key:"bind",value:function(){this.gl.bindVertexArray(this.vao)}}]),e}(),g=function(){function e(t){Object(h.a)(this,e),this.gl=t,this.stride=0,this.attributes=[]}return Object(u.a)(e,[{key:"push_attribute",value:function(e,t,i,n){var r=this.sizeof(i),s=new w(e,t,i,n,r);this.attributes.push(s),this.stride+=t*r}},{key:"slice",value:function(t,i){var n=new e;return n.stride=this.stride,n.attributes=this.attributes.slice(t,i),n}},{key:"sizeof",value:function(e){var t=this.gl;switch(e){case t.FLOAT:case t.UNSIGNED_INT:case t.INT:return 4;default:throw new Error("Unknown element type: ".concat(e))}}}]),e}(),w=function e(t,i,n,r,s){Object(h.a)(this,e),this.index=t,this.count=i,this.type=n,this.is_normalised=r,this.size=s},E=function(){function e(t){Object(h.a)(this,e),this.callback=t}return Object(u.a)(e,[{key:"apply",value:function(e){this.callback(e)}}]),e}(),m=function(){function e(t,i){Object(h.a)(this,e),this.gl=t,this.buffer=t.createBuffer(),this.count=i.length,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW)}return Object(u.a)(e,[{key:"bind",value:function(){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer)}}]),e}(),y="#version 300 es\nprecision mediump float;\n\nin vec2 position;\n\nout vec2 vPosition;\n\nvoid main() {\n    vPosition = (position + vec2(1,1))/2.0;\n    gl_Position = vec4(position.x, position.y, 0.0, 1.0);\n}",T="#version 300 es\nprecision mediump float;\nprecision highp sampler2D;\n\nin vec2 vPosition;\n\nout vec4 FragColour;\n\nuniform sampler2D uDataTexture;\n\nvoid main() {\n    vec4 cell = texture(uDataTexture, vPosition);\n    float state = cell[0];\n    FragColour = vec4(state, state, state, 1.0);\n    // FragColour = vec4(vPosition.x, vPosition.y, 1.0, 1.0);\n}",x=i(11),k=function(){function e(t){Object(h.a)(this,e),this.gl=t,this.clear_colour=new Float32Array([1,1,1,1])}return Object(u.a)(e,[{key:"clear",value:function(){var e=this.gl;e.clearColor.apply(e,Object(x.a)(this.clear_colour)),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"draw",value:function(e,t,i){var n=this.gl;i.bind(),e.bind(),t.bind(),n.drawElements(n.TRIANGLES,t.count,n.UNSIGNED_INT,0)}}]),e}(),R=function(){function e(t,i,n){Object(h.a)(this,e),this.gl=t,this.data=i,this.shape=n,this.texture=t.createTexture(),this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,t.R8,n[0],n[1],0,t.RED,t.UNSIGNED_BYTE,this.data)}return Object(u.a)(e,[{key:"bind",value:function(){var e=this.gl;e.bindTexture(e.TEXTURE_2D,this.texture)}},{key:"active",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.gl;this.bind(),t.activeTexture(t.TEXTURE0+e)}}]),e}(),O=function(){function e(t){Object(h.a)(this,e),this.gl=t,this.fb=t.createFramebuffer()}return Object(u.a)(e,[{key:"attach_texture2D",value:function(e){var t=this.gl,i=e.texture;this.bind(),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),this.unbind()}},{key:"bind",value:function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.fb)}},{key:"unbind",value:function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)}}]),e}(),A=function(){function e(t,i,n){Object(h.a)(this,e),this.gl=t,this.shape=n,this.data=i,this.count=n[0]*n[1],this.data_texture=new R(t,this.data,this.shape),this.frame_buffer=new O(t),this.frame_buffer.attach_texture2D(this.data_texture)}return Object(u.a)(e,[{key:"refresh",value:function(){var e=this.gl;e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.shape[0],this.shape[1],e.RED,e.UNSIGNED_BYTE,this.data)}},{key:"bind",value:function(){this.data_texture.active(0)}}]),e}(),j=function(e){Object(l.a)(i,e);var t=Object(c.a)(i);function i(e,n,r,s){var a;return Object(h.a)(this,i),(a=t.call(this,e,n,r,s)).result=null,a}return Object(u.a)(i,[{key:"create",value:function(e,t,n,r){return new i(e,t,n,r)}},{key:"create_horizontal",value:function(e,t){return this.create(e.ne,t.nw,e.se,t.sw)}},{key:"create_vertical",value:function(e,t){return this.create(e.sw,e.se,t.nw,t.ne)}},{key:"create_center",value:function(){return this.create(this.nw.se,this.ne.sw,this.sw.ne,this.se.nw)}},{key:"get_next_generation",value:function(){if(null!==this.result)return this.result;if(0===this.population)return this.result=this.nw,this.result;if(2===this.level)return this.result=this.slow_simulation(),this.result;var e=this.nw.get_next_generation(),t=this.create_horizontal(this.nw,this.ne).get_next_generation(),i=this.ne.get_next_generation(),n=this.create_vertical(this.nw,this.sw).get_next_generation(),r=this.create_center().get_next_generation(),s=this.create_vertical(this.ne,this.se).get_next_generation(),a=this.sw.get_next_generation(),o=this.create_horizontal(this.sw,this.se).get_next_generation(),h=this.se.get_next_generation(),u=this.create(e,t,n,r).get_next_generation(),c=this.create(t,i,r,s).get_next_generation(),l=this.create(n,r,a,o).get_next_generation(),f=this.create(r,s,o,h).get_next_generation();return this.result=this.create(u,c,l,f),this.result}},{key:"slow_simulation",value:function(){for(var e=0,t=0;t<4;t++)for(var i=0;i<4;i++)e|=this.get(t,i)<<t+4*i;var n=this.create(this.one_generation(e>>0)),r=this.create(this.one_generation(e>>1)),s=this.create(this.one_generation(e>>4)),a=this.create(this.one_generation(e>>5));return this.create(n,r,s,a)}},{key:"one_generation",value:function(e){if(0===e)return 0;var t=e>>5&1;e&=1879;for(var i=0;0!==e;)i++,e&=e-1;return 3===i||2===i&&0!==t?1:0}}]),i}(function(){function e(t,i,n,r){if(Object(h.a)(this,e),void 0===i){if("object"===typeof t)throw console.error(t),new Error("Invalid level 0 node");return this.population=t,void(this.level=0)}if(this.nw=t,this.ne=i,this.sw=n,this.se=r,this.nw.level!==this.ne.level||this.nw.level!==this.sw.level||this.nw.level!==this.se.level)throw console.error(this),new Error("Nodes of level are not the same: ".concat(this));this.level=this.nw.level+1,this.population=t.population+i.population+n.population+r.population}return Object(u.a)(e,[{key:"create",value:function(t,i,n,r){return new e(t,i,n,r)}},{key:"create_tree",value:function(e,t){if(0===t)return this.create(e);var i=this.create_tree(e,t-1);return this.create(i,i,i,i)}},{key:"set",value:function(e,t,i){if(0===this.level)return this.create(i);var n=1<<this.level-1,r=[this.nw,this.ne,this.sw,this.se],s=r[0],a=r[1],o=r[2],h=r[3];return e>=n?t<n?s=this.nw.set(e-n,t,i):o=this.sw.set(e-n,t-n,i):t<n?a=this.ne.set(e,t,i):h=this.se.set(e,t-n,i),this.create(s,a,o,h)}},{key:"get",value:function(e,t){if(0===this.level)return this.population;var i=1<<this.level-1;return e>=i?t<i?this.ne.get(e-i,t):this.se.get(e-i,t-i):t<i?this.nw.get(e,t):this.sw.get(e,t-i)}},{key:"expand",value:function(){var e=this.create_tree(0,this.level-1),t=this.create(e,e,e,this.nw),i=this.create(e,e,this.ne,e),n=this.create(e,this.sw,e,e),r=this.create(this.se,e,e,e);return this.create(t,i,n,r)}}],[{key:"bootstrap",value:function(t,i){return new e(0).create_tree(t,i)}}]),e}());var F=function(){function e(){Object(h.a)(this,e),this.map={}}return Object(u.a)(e,[{key:"put",value:function(e,t){var i=this.map[e];if(void 0===i)return this.map[e]=[t],t;var n,r=Object(_.a)(i);try{for(r.s();!(n=r.n()).done;){var s=n.value;if(s.equals(t))return s}}catch(a){r.e(a)}finally{r.f()}return i.push(t),t}}]),e}(),U=function(e){Object(l.a)(i,e);var t=Object(c.a)(i);function i(e,n,r,s){var a;return Object(h.a)(this,i),(a=t.call(this,e,n,r,s)).address=i.generate_id(),a}return Object(u.a)(i,[{key:"equals",value:function(e){return e.level===this.level&&(0===e.level?e.population===this.population:e.nw===this.nw&&e.ne===this.ne&&e.sw===this.sw&&e.se===this.se)}},{key:"hash_code",value:function(){return 0===this.level?this.population:this.nw.address+11*this.ne.address+101*this.sw.address+1007*this.se.address}},{key:"create",value:function(e,t,n,r){var s=new i(e,t,n,r);return s=i.put_default_node(s)}}],[{key:"generate_id",value:function(){var e=i.CurrentID;return i.CurrentID+=7,e}},{key:"put_default_node",value:function(e){var t=e.hash_code(),n=i.HashedNodes.put(t,e);if(!e.equals(n))throw console.error("Bad entries"),console.error(n,n.hash_code()),console.error(e,e.hash_code()),new Error("Mismatch in hash list");return n}},{key:"bootstrap",value:function(e,t){return new i(0).create_tree(e,t)}}]),i}(j);U.HashedNodes=new F,U.CurrentID=101;var D=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;Object(h.a)(this,e),this.root=U.bootstrap(0,t),this.construct_buffer()}return Object(u.a)(e,[{key:"construct_buffer",value:function(){if(this.root.level!==this.current_level){this.current_level=this.root.level;var e=1<<this.root.level;this.shape=[e,e],this.count=e*e,this.buffer=new Uint8Array(this.count)}}},{key:"randomise",value:function(){for(var e=1<<this.root.level,t=0;t<e;t++)for(var i=0;i<e;i++){(Math.random()>.5?1:0)&&(this.root=this.root.set(t,i,1))}}},{key:"step",value:function(){this.root.level>=9?this.wrapped_step():this.expanding_step(),this.update_buffer()}},{key:"expanding_step",value:function(){for(;;){var e=this.root,t=[e.nw,e.ne,e.sw,e.se],i=t[0],n=t[1],r=t[2],s=t[3];if(!(e.level<3||i.population!==i.se.se.population||n.population!==n.sw.sw.population||r.population!==r.ne.ne.population||s.population!==s.nw.nw.population))break;this.root=this.root.expand()}this.root=this.root.get_next_generation()}},{key:"wrapped_step",value:function(){var e=this.root,t=this.root.get_next_generation(),i=e.create(e.ne,e.nw,e.se,e.sw).get_next_generation(),n=e.create(e.sw,e.se,e.nw,e.ne).get_next_generation(),r=e.create(e.se,e.sw,e.ne,e.nw).get_next_generation(),s=e.create(r.se,n.sw,i.ne,t.nw),a=e.create(n.se,r.sw,t.ne,i.nw),o=e.create(i.se,t.sw,r.ne,n.nw),h=e.create(t.se,i.sw,n.ne,r.nw),u=e.create(s,a,o,h);this.root=u}},{key:"update_buffer",value:function(){this.construct_buffer(),this.draw_recursive(this.root,0,0)}},{key:"draw_recursive",value:function(e,t,i){if(0!==e.level){var n=1<<e.level-1;this.draw_recursive(e.nw,t,i),this.draw_recursive(e.ne,t+n,i),this.draw_recursive(e.sw,t,i+n),this.draw_recursive(e.se,t+n,i+n)}else this.buffer[t+i*this.shape[0]]=e.population?0:255}}]),e}(),S={vertex_data:new Float32Array([-1,-1,-1,1,1,-1,1,1]),index_data:new Uint32Array([0,3,1,0,2,3])},I=function(){function e(t){Object(h.a)(this,e),this.gl=t,this.renderer=new k(t),this.shader=new v(t,y,T),this.shader.add_uniform("uDataTexture",new E((function(e){return t.uniform1i(e,0)}))),this.vbo=new p(t,S.vertex_data,t.STATIC_DRAW),this.ibo=new m(t,S.index_data);var i=new g(t);i.push_attribute(0,2,t.FLOAT,!1),this.vao=new b(t),this.vao.add_vertex_buffer(this.vbo,i),this.sim=new D(8),this.sim.randomise(),this.sim.update_buffer(),this.grid=new A(t,this.sim.buffer,this.sim.shape),this.steps=0}return Object(u.a)(e,[{key:"run",value:function(){requestAnimationFrame(this.loop.bind(this))}},{key:"loop",value:function(){this.on_update(),this.on_render(),requestAnimationFrame(this.loop.bind(this))}},{key:"on_update",value:function(){this.step(),this.steps>0&&(this.step(),this.steps-=1)}},{key:"step",value:function(){this.sim.step(),this.sim.update_buffer(),this.sim.buffer!==this.grid.data?this.grid=new A(this.gl,this.sim.buffer,this.sim.shape):this.grid.refresh()}},{key:"on_render",value:function(){this.gl;this.shader.bind(),this.vao.bind(),this.ibo.bind(),this.grid.bind(),this.renderer.clear(),this.renderer.draw(this.vao,this.ibo,this.shader)}}]),e}(),N=function(e){Object(l.a)(i,e);var t=Object(c.a)(i);function i(e){var r;return Object(h.a)(this,i),(r=t.call(this,e)).ref=Object(n.createRef)(),r.state={failed_webgl:!1},r}return Object(u.a)(i,[{key:"componentDidMount",value:function(){var e=this.ref.current.getContext("webgl2");if(e){var t=new I(e);t.run(),this.app=t}else this.setState(Object(o.a)({},this.state,{failed_webgl:!0}))}},{key:"step",value:function(){void 0!==this.app&&(this.app.steps=1)}},{key:"render",value:function(){var e=this;return this.state.failed_webgl?r.a.createElement("div",null,"Requires WebGL2 Support"):r.a.createElement("div",null,r.a.createElement("button",{onClick:function(t){return e.step()}},"Step"),r.a.createElement("canvas",{width:800,height:800,ref:this.ref}))}}]),i}(r.a.Component);a.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(N,null)),document.getElementById("root"))}},[[13,1,2]]]);
//# sourceMappingURL=main.11a12193.chunk.js.map